<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Book a Day — Amin Bukhari</title>

<!-- SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
:root{--bg:#f6f7f9;--text:#111827;--muted:#6b7280;--brand:#111827;--card:#ffffff;--border:#e5e7eb}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;background:var(--bg);color:var(--text)}
.container{max-width:840px;margin:0 auto;padding:24px}
.nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:16px;justify-content:space-between}
.nav-left{display:flex;gap:8px;flex-wrap:wrap}
.nav a{padding:8px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;color:#111;text-decoration:none;font-size:14px}
.nav a.brand{background:var(--brand);color:#fff;border-color:var(--brand)}
.lang-toggle{cursor:pointer;font-size:14px;color:#111;padding:6px 10px;border:1px solid var(--border);border-radius:10px;background:#fff}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
h1{font-size:24px;margin:0 0 8px 0}
label{font-size:14px;font-weight:600;margin-bottom:6px;display:block}
input[type="text"],input[type="date"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;font-size:14px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media (max-width:720px){.row{grid-template-columns:1fr}}
.btn{display:inline-block;padding:10px 14px;border-radius:12px;background:var(--brand);color:#fff;border:0;cursor:pointer;font-size:14px;text-decoration:none}
.alert{padding:10px 12px;border-radius:12px;margin-top:8px}
.alert.error{background:#fee2e2;color:#991b1b}
.alert.ok{background:#dcfce7;color:#14532d}
.spinner{display:inline-block;width:18px;height:18px;border:2px solid #ddd;border-top-color:#111827;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
footer{margin-top:24px;color:#6b7280;font-size:12px}
</style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a href="index.html" data-en="Home" data-ar="الرئيسية">Home</a>
        <a class="brand" href="book.html" data-en="Book a Day" data-ar="حجز يوم">Book a Day</a>
        <a href="bookings.html" data-en="View Bookings" data-ar="عرض الحجوزات">View Bookings</a>
        <a href="admin.html" data-en="Admin" data-ar="الإدارة">Admin</a>
      </div>
      <div><button id="langBtn" class="lang-toggle">عربي</button></div>
    </nav>

    <div class="card">
      <h1 data-en="Book the Reception Room (Full Day) — by Amin Bukhari"
          data-ar="حجز قاعة الاستقبال (يوم كامل) — بواسطة أمين بخاري">
          Book the Reception Room (Full Day) — by Amin Bukhari
      </h1>
      <form id="book-form" class="row">
        <div>
          <label for="apt" data-en="Apartment / Unit" data-ar="رقم الشقة">Apartment / Unit</label>
          <input type="text" id="apt" placeholder="A-1203" required />
        </div>
        <div>
          <label for="date" data-en="Date" data-ar="التاريخ">Date</label>
          <input type="date" id="date" required />
        </div>
        <div>
          <button type="submit" class="btn">
            <span data-en="Book Day" data-ar="تأكيد الحجز">Book Day</span>
            <span id="spinner" class="spinner" style="display:none"></span>
          </button>
        </div>
      </form>
      <div id="err" class="alert" role="alert" style="display:none"></div>
      <div id="ok" class="alert" role="status" style="display:none"></div>
      <small data-en="Your booking has been recorded successfully."
             data-ar="تم حفظ الحجز بنجاح.">
             Your booking has been recorded successfully.
      </small>
    </div>

    <footer data-en="© 2025 Reception Room Booking — Amin Bukhari"
            data-ar="© ٢٠٢٥ حجز قاعة الاستقبال — أمين بخاري">
            © 2025 Reception Room Booking — Amin Bukhari
    </footer>
  </div>

<script>
  // Language toggle
  let isArabic = false;
  const btn = document.getElementById('langBtn');
  btn.addEventListener('click', ()=>{
    isArabic = !isArabic;
    btn.textContent = isArabic ? "English" : "عربي";
    document.querySelectorAll('[data-en]').forEach(el=>{
      el.textContent = isArabic ? el.getAttribute('data-ar') : el.getAttribute('data-en');
    });
    document.dir = isArabic ? "rtl" : "ltr";
  });

  // Config (kept hidden from UI)
  const firebaseConfig = {
    apiKey: "AIzaSyBsJoJnj1r2EnfZLVpZauLba5Ei-BmeoKU",
    authDomain: "roombookings-bee0c.firebaseapp.com",
    projectId: "roombookings-bee0c",
    storageBucket: "roombookings-bee0c.firebasestorage.app",
    messagingSenderId: "604726620304",
    appId: "1:604726620304:web:695a896a75df0cf7bba815",
    measurementId: "G-P8070XN3K9"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Helpers
  function todayISO(){ return new Date().toISOString().slice(0,10); }
  function show(el){ el.style.display='block'; }
  function hide(el){ el.style.display='none'; }
  function formatDatePretty(iso){
    try { const d=new Date(iso+'T00:00:00'); return d.toLocaleDateString(undefined,{weekday:'short',year:'numeric',month:'short',day:'numeric'}); } catch { return iso; }
  }

  async function bookDay(date, apt){
    const ref = db.collection("bookings").doc(date); // one booking per day
    const snap = await ref.get();
    if (snap.exists) {
      const data = snap.data();
      throw new Error((isArabic ? "عذراً، " : "Sorry, ") + date + (isArabic ? " محجوز بواسطة " : " is already booked by ") + data.apt + ".");
    }
    await ref.set({ date, apt });
  }

  // UI logic
  const form = document.getElementById('book-form');
  const apt = document.getElementById('apt');
  const date = document.getElementById('date');
  const ok = document.getElementById('ok');
  const err = document.getElementById('err');
  const spinner = document.getElementById('spinner');

  date.min = todayISO();

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    hide(ok); hide(err);
    spinner.style.display = 'inline-block';

    const aptVal = apt.value.trim();
    const dateVal = date.value;
    if(!aptVal){ err.textContent = isArabic ? "الرجاء إدخال رقم الشقة." : "Please enter your apartment number."; show(err); spinner.style.display='none'; return; }
    if(!dateVal){ err.textContent = isArabic ? "الرجاء اختيار تاريخ." : "Please choose a date."; show(err); spinner.style.display='none'; return; }

    try{
      await bookDay(dateVal, aptVal);
      ok.textContent = (isArabic ? "تم الحجز لـ " : "Booked ") + formatDatePretty(dateVal) + (isArabic ? " للشقة " : " for apartment ") + aptVal + ".";
      show(ok);
      form.reset();
      date.min = todayISO();
    }catch(ex){
      err.textContent = ex.message || (isArabic ? "تعذر إتمام الحجز." : "Could not complete booking.");
      show(err);
    }finally{
      spinner.style.display = 'none';
    }
  });
</script>
</body>
</html>
